<head>
    <script src="../build/index.js"></script>
    <script src="../build/plugin.webgl.js"></script>
    <script src="../build/plugin.webgl.three-loader.js"></script>
    <script src='../resource/mmd/lib/mmdparser.min.js'></script>
    <script src='../resource/fbxdds/zlib.min.js'></script>
</head>

<style>
    canvas {
        border: 1px solid grey;
        background-color: #4caf50;
        /*opacity: 0.05;*/
    }
</style>

<body>
    <canvas id="foo" width="600" height="600"></canvas>

    <script>
        var $Painter = new Easycanvas.painter();
        $Painter.register(document.getElementById('foo'), {
            webgl: {
              // light: true,
            },
        });
        $Painter.start();

        var $box = $Painter.add({
            style: {
                tx: 200, ty: 500,
            },
        });

        // var MMDLoader = new Easycanvas.threeLoaders.MMDLoader();
        // MMDLoader.loadPMX('../resource/mmd/model/default/miku.pmx', function (data) {
        //     console.warn(data);
        // });

        var FBXLoader = new Easycanvas.threeLoaders.FBXLoader();
        FBXLoader.load('../resource/fbxdds/mx.fbx', function (data) {
        // FBXLoader.load('../resource/fbxdds/xiaoxiongmao.fbx', function (data) {
            window.data = data;

            for (let i in data.Objects.Geometry) {
                let item = data.Objects.Geometry[i];

                let indices = item.PolygonVertexIndex.a.map((number, index) => {
                    if (index % 3 === 2) return -number - 1;
                    return number;
                });
                // window.indices = indices;
                // indices = item.PolygonVertexIndex.a.filter((number) => {
                //     return number >= 0;
                // });
                // console.log(indices)
                // indices.pop();
                // indices.pop();
                // indices.pop();

                $box.add({
                    webgl: window.Easycanvas.webglShapes.custom({
                        vertices: item.Vertices.a,
                        indices: indices,
                        // img: texture2img[model.img],
                        // textures: model.textures,
                        scale: 300,
                        // colors: !textures.length ? colors : undefined,
                        colors: [
                            Math.random() * 255,
                            Math.random() * 255,
                            Math.random() * 255,
                            // Math.random() * 255,
                        ],
                        rx: 90,
                        rz: Easycanvas.transition.pendulum(0, 360, 5000).loop(),
                    }),
                });
            }
        });
    </script>
</body>

